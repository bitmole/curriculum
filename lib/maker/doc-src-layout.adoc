== The document source setup

Our documentation sources are divided into pathways and lessons,
which are in the subdirectories `pathways` and `lessons`
respectively. A pathway is broadly a concatenation of a chosen
ordered set of lessons (with some pathway-specific resources
thrown in).

The _built_ versions of a pathway (called a _course_) is created
in the `distribution` subdir. Typically the built name of the
pathway and the lesson are the same as their names in the source,
but not always. Let's use an example. A typical source pathway subdir would be
`pathways/core` and a typical source lesson subdir would be
`lessons/simple-data-types`. 

=== Multiple natural languages

First, we may want to create the course `core` in
multiple natural languages, e.g, English (`en-us`) or Spanish
(`es-mx`). To accommodate this, the source dir `pathway/core` has
a `langs` subdir, with further subdirs for each natlang we want:
e.g., `en-us` and `es-mx`.  The source tree thus looks like:

  pathway/
  `—— core/
      `—— langs/
          |—— en-us/
          `—— es-mx/

We'll call the `pathway/core/langs/en-us` the `core` pathway's
root directory (for the `en-us` natlang).

We therefore need _two_ different distribution courses for `core`,
one for each natlang. To accommodate this, the `distribution` has
subdirs for each natlang, and the natlang-specific course for
`core` is placed in the `courses` subdir of these. Thus, the
distribution tree will have both natlang versions of `core` as
follows:

  distribution/
  |—— en-us/
  |   `—— courses/
  |       `—— core/
  `—— es-mx/
      `—— courses/
          `—— core/

Note that we use the same name `core` for the two natlang
versions in the distribution. We can do this because they reside
inside two different subtrees `distribution/en-us` 
`distribution/es-mx`.

We will call `distribution/en-us/courses/core` the `core`
course's root directory.

In the following, we will assume the prevailiing natural language is
`en-us`. For other natlangs, the setup is exactly the same but in
the appropriate natlang-based subtree.

=== Pathway narratives

The pathway root directory has a file `index.adoc`, which
specifies the
_pathway narrative_.  This gets converted to `index.shtml` in the
course root directory. The pathway root also has a `resources/`
subdirectory that houses additional documentation that is
specific to teachers. The pathway root may also contain subdirs
for `front-matter`, `back-matter`, and `images`: the former two
add flanking matter to the final workbook for the pathway's
course, while `images` is a convenient location for image
subfiles.

=== Proglang associated with a pathway


By default, the programming language associated with a course is
`pyret`. This is marked in the course root directory as the 0-length
file `.cached/.proglang-pyret`.  (I.e.,
`distribution/en-us/courses/core/.cached/.proglang-pyret`.)

We may also want to create the courses for the `core` pathway for
multiple programming languages, e.g., `pyret` and `wescheme`. To
accommodate this, we include the file `proglang.txt` in the
pathway root directory (`pathways/core/langs/en-us/`), and list
in it the various proglangs supported. Thus the contents of
`proglang.txt` will look like:

  pyret
  wescheme

This causes two different courses for `core` to be created in
`distribution/en-us/courses`.
We use the unadorned pathway name, `core`, for the Pyret version.
For the WeScheme version, the course is entitled `core-wescheme`.
I.e., the two course root directories are 

  distribution/en-us/courses/core
  distribution/en-us/courses/core-wescheme

These two directories have their own proglang marker files, i.e.,
`.cached/.proglang-pyret` (as before)
and
`.cached/.proglang-wescheme`.

Sometimes we have a pathway that has associated with it only a
single proglang, but that proglang is not Pyret. As an example,
consider the
pathway `shipwrecks` which is defined for the proglang
`spreadsheets`. In this case, we still need a
`proglang.txt` file containing
the single line

  spreadsheets

The built course for this pathway is called `shipwrecks` rather
than `shipwrecks-spreadsheets`, since there is no Pyret version
to distinguish it from.

=== Lessons associated with a pathway

The pathway root directory has a file `lesson-order.txt` listing
the names of the lessons associated with it, in order. These
lessons occur as directories in the `lessons/` directory in the
repo top dir.

As with pathways, lessons can be in different natlangs and
proglangs. To accommodate multiple natlangs, each lesson has a
`langs` subdir, with subdirs (e.g., `en-us`, `es-mx`) for the
different natlangs. (This is similar to how we specify multiple
natlangs for pathways.)

   lessons/
   `—— simple-data-types/
       `—— langs/
           |—— en-us/
           `—— es-mx/

We'll call `lessons/simple-data-types/langs/en-us` the lesson root
directory.

On building, the `en-us` version of `simple-data-types` is placed
in
`distribution/en-us/lessons/simple-data-types`, the distribution
lesson root directory.

As for pathways, a lesson root directory can contain a
`proglang.txt` listing the proglang(s) associatable with it. If
no `proglang.txt` is present, the (single) proglang is assumed to
be `pyret`.

If more than one proglang is needed, or if the single proglang is
something other than `pyret`, list it in `proglang.txt`.  The
distribution root directories of the non-Pyret lesson have the
proglang as a hyphenated suffix, e.g.,

  simple-data-types-wescheme

Again, as with pathways, a marker file
`.cached/.proglang-wescheme` is placed in the distribution lesson
root to identify it as a lesson using `wescheme`.

Note that the pathway mentions in its `lesson-order.txt` the
lesson names in unadorned form. On building, a pathway becomes a
course, and the distribution lessons associated with it are the
right versions corrected for proglang. Thus the pathway `core`
has `simple-data-types` as a constituent lesson. Moving over to
the built `distribution`, the course `core` (Pyret) includes the lesson
`simple-data-types` (Pyret), and the course `core-wescheme`
includes the lesson `simple-data-types-wescheme`.


==== Lesson plans

The lesson counterpart to the pathway narrative is the `lesson
plan`, given as an `index.adoc` file in the lesson root
directory. This gets converted to `index.shtml` in the
distribution lesson root. Here too, an `images/` subdir is used
for image subfiles.

==== Lesson workbook pages

A lesson typically contains a `pages/` subdir, which consist of
AsciiDoc sources for the pages in that lesson. The `pages/`
subdir has a file `workbook-pages.txt`, listing all these pages
in order. These pages get converted to corresponding `.html`
files in the `pages/` subdir for the lesson in the distribution.

A lesson may also contain other subdirs, even within its
`pages/`. These may contain files meant for inclusion in the main
pages files. 

==== Adding proglang-specific source

We've seen that both pathways and lessons may have `proglang.txt`
identifying multiple proglangs as vehicles for that
course/lesson. Proglang-specific material is specified in the
source in two ways:

1: We use the directive `@ifproglang{pyret}{...}` to specify source fragments
meant for the proglang `pyret`. 

2: Especially in the `pages/` subdirs, we use further
subdirs named for the proglang to add files that would shadow the
main files. Thus for a file `pages/abc.adoc`, the file
`pages/pyret/abc.adoc` would shadow it for `pyret`, and file
`pages/wescheme/abc.adoc` would shadow it for `wescheme`. If we
provide shadowing files for all relevant proglangs, the main file
doesn't need to exist.

==== Solution-mode pages

The `pages/` subdir in a lesson contributes to the student
version of the final workbook. However, we also have solutions
workbook that is intended for teachers. We have a
`solution-pages/` subdir alongside `pages/`, which contains files
that will shadow the similarly named student pages.
