= Datasheet

This directory contains two scripts `make-questionnaire.rkt` and
`sanitize.rkt`.

- `make-questionnaire.rkt` takes a datasheet spec file, say
  `D-admin.adoc`, and produces
  a student-facing file, `D-student.adoc`, that each student fills out.

- `sanitize.rkt` checks the filled `D-student.adoc` for errors and
  corrects it in-place. A sanitized `D-student.adoc` can then be
  processed by Asciidoctor to produce an HTML version of the
  student's answers.

It also includes a sample spec file, `D-admin.adoc`, and other
production datasheets as they are authored.

== Format of the `D-admin.adoc` file

The `D-admin.adoc` file contains a list of tags with the paragraph
that each tag expands to. E.g., a tag `_Description` could be
defined as:

   :_Description:
   These questions relate to the Frobbotz dataset. Your
   answers will help clarify what Frobbotz's benefits, demands,
   and consequences are.

All tags end with a blank line or end-of-file. This tag is a not
a question, and there is no expectation of an answer by the
student. Non-question tags have a leading underscore (`++_++`).

A tag that doesn't start in an underscore is a question tag.
E.g.,

    :origin:
    Where did the Frobbotz data come from?

In addition to these tag descriptions, the admin file contains
other comments that mark the structure (sections) holding up the
questionnaire. E.g.,

    // == Questions relating to Frobbotz's dispersal

This identifies a subsection with its header.

== The student-facing file, `D-student.adoc`

The command

    make-questionnaire.rkt D-admin.adoc.

creates the corresponding student-facing file, `D-student.adoc`.

This file is a copy of `D-admin.adoc` with all the structural
comments uncommented. Thus, the commented section header above
becomes

    == Questions relating to Frobbotz's dispersal

The tag definitions are converted tag inclusions, and
their values are given as AsciiDoc comments so that the student
can read them and enter the appropriate answer in the space
indicated. E.g., the tagged question `:origin:` above becomes

    include::D-admin-origin.adoc[]
    //
    // Where did the Frobbotz data come from?
    //
    // PLEASE MODIFY TEXT BELOW THIS LINE FOR YOUR ANSWER
    //
    Ad rem est vero cum ratione. Optio dolor molestiae consequatur
    perferendis sint amet eligendi. Minus unde odit quod officia sit
    ut impedit facilis. Voluptatum alias illo et dolore impedit aut
    vitae qui. Laborum itaque ipsa possimus et.

The student replaces the Latin filler text with their actual
answer.

The tags that define non-questions are also translated to tag
inclusions. Their text is also commented, so the student can read them
for guidance, but there is no invitation to write under them (and
no filler text). Thus the `:_Description:` tag above becomes:

   include::D-admin-_Description.adoc[]
   //
   // These questions relate to the Frobbotz dataset. Your
   // answers will help clarify what Frobbotz's benefits, demands,
   // and consequences are.
   //

== Editing and submitting `D-student.adoc`

The student edits `D-student.adoc` using the text editor of their
choice. Answers are written in the spaces advised. The comments
-- whether guidelines or questions -- tolerate any amount of
mangling, as they are just comments. The tag inclusion lines
ideally should not be
tampered with.

== Sanitizing `D-student.adoc`

Running

    sanitize.rkt D-student.adoc

corrects any damage the file may have incurred during the editing
process. `sanitize.rkt` uses the admin file, `D-admin.adoc`, to
ensure that all the guidelines and questions are re-inserted
correctly, and that all tags are present and answered, and are in the
right order. Cases of serious manglage are reported as failure,
so the file can be discarded as invalid.
