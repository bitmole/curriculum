#!/bin/bash

# last modified 2023-02-22

ARGS=
BOOK=
FORCE=
GRAPH=
HELP=
LINKCHECK=
NATLANG=en-us

export BOOK GRAPH LINKCHECK NATLANG

function displayhelp() {
  echo "Usage: build-pathway <options>"
  echo
  echo "  " --book, --pdf, -b:
  echo "        " Generate PDFs, including individual pages and workbooks
  echo "  " --force, --superforce, --super-force, -f:
  echo "        " Regenerate doc tree from scratch
  echo "  " --graph, -g:
  echo "        " Generate dependency graph
  echo "  " --help, -h:
  echo "        " Display this help and exit
  echo "  " --lint, --verify-links, -l:
  echo "        " Verify all the links in the doc tree
  echo "  " --natlang L:
  echo "        " Build doc tree for natural language L. Default: en-us
  echo "  " -bf, -fb:
  echo "        " Combine -f and -b
  exit
}

while test $# -ne 0; do
  arg=$1; shift
  if test "$arg" = --book -o "$arg" = --pdf -o "$arg" = -b; then
    BOOK=yes
  elif test "$arg" = --force -o "$arg" = --superforce -o "$arg" = --super-force -o "$arg" = -f; then
    FORCE=yes
  elif test "$arg" = --graph -o "$arg" = -g; then
    GRAPH=yes
  elif test "$arg" = --help -o "$arg" = -h; then
    HELP=yes
  elif test "$arg" =  --lint -o "$arg" = --verify-links -o "$arg" = -l; then
    LINKCHECK=yes
  elif test "$arg" = --natlang; then
    NATLANG=$1; shift
  elif test "$arg" = -bf or "$arg" = -fb; then
    FORCE=yes; BOOK=yes
  else
    echo build-pathway passed bad arg: $arg "$@"
    exit
  fi
done

test -n "$FORCE" && make clean

test -n "$HELP" && displayhelp

make
