# last modified 2020-05-05

userid=$1

pwy=

if test $# -ge 2; then
  pwy=$2
fi

if test ! -d distribution; then
  echo distribution/ not found; exit
fi

cd distribution

test -d courses && rm -fr courses

mkdir courses

function copyCourse() {
  local src=$1
  test -d $src || return
  local dest=$(pathwayNameOnServer $src)
  cp -pr $src courses/$dest
}

function pathwayNameOnServer() {
  local localName=$1
  case $localName in
    game-pathway-wescheme) echo algebra-wescheme-remix;;
    game-pathway-pyret) echo algebra-pyret-remix;;
    data-science-pathway) echo datascience-remix;;
    reactive-pathway) echo reactive-remix;;
    flags-pathway) echo flags-remix;;
    *) echo $1-remix;;
  esac
}

if test $pwy; then
  copyCourse $pwy
else
  copyCourse game-pathway-wescheme
  copyCourse game-pathway-pyret
  copyCourse data-science-pathway
  copyCourse reactive-pathway
  copyCourse flags-pathway
fi

test -f courses.tar.bz2 && rm courses.tar.bz2

echo Tarring up courses...
tar jcf courses.tar.bz2 courses

echo Copying courses tarball to brown.edu...
scp courses.tar.bz2 $userid@ssh.cs.brown.edu:tmp/.

cd ..

./deploy-to-brown-perms $userid

