# last modified 2020-01-21

if test -f distribution.tar.bz2; then
  rm -fr distribution
  tar jxf distribution.tar.bz2
fi

if test ! -d distribution; then
  echo distribution/ not found; exit
else
  for f in pyret wescheme; do
    if test ! -d distribution/bs-game-pathway-$f; then
      echo distribution/bs-game-pathway-$f not found; exit
    fi
  done
fi

YEAR=2020
SEMESTER=spring

DEPLOY_DIR=/gpfs/main/authen/sys/web/cs/web/sites/bootstrapworld.org/materials/$SEMESTER$YEAR/courses

ON_DEPLOY_SITE=true

if test ! -d $DEPLOY_DIR; then
  ON_DEPLOY_SITE=false
  echo $DEPLOY_DIR not found -- using ~/tmp instead
  DEPLOY_DIR=~/tmp
  if test ! -d $DEPLOY_DIR; then
    mkdir $DEPLOY_DIR
  fi
fi

if $ON_DEPLOY_SITE; then
  find distribution -type d | xargs chmod g+rwx,o+rx
  find distribution -type f | xargs chmod g+rw,o+r
  chgrp -R cs-plt distribution
fi

function copydir() {
  src=$1
  dest=$2
  rm -fr $dest
  cp -prH $src $dest
}

for proglang in pyret wescheme; do
  copydir distribution/bs-game-pathway-$proglang $DEPLOY_DIR/algebra-$proglang-remix
done

copydir distribution/bs-data-science-pathway $DEPLOY_DIR/datascience-remix

copydir distribution/bs-reactive-pathway $DEPLOY_DIR/reactive-remix
