= Table Methods
@description{Students learn about _table methods_, which allow them to order, filter, and build columns to extend the animals table.}

@lesson-prereqs{functions-examples-definitions, displays-and-lookups}

@keywords{filter, filtering}

@add-to-lang{.order-by, .filter, .build-column}

[@lesson-intro-table]
|===

| Lesson Goals
| Students will be able to...

* order the Animals Dataset by a number of criteria
* filter the Animals Dataset by species, fixed status, and age
* add a column to the Animals Dataset

| Student-facing Lesson Goals
|

* Let’s learn how transform one table into another.

| Materials
|[.materials-links]
* @link{https://docs.google.com/presentation/d/1EZp_E7MUNi6fdYplzMKcwIrRigdPX4N-B1gdtSCSJ5M/, Lesson Slides}

@material-links

|===

== Functions that Work on Rows @duration{15 minutes}

=== Overview
Students review row definitions, and get more practice reading the definitions of functions that work on rows.

=== Launch
Load the @starter-file{table-methods}, go to the File menu, and click "Save a Copy".

This activity is about reading carefully, getting more comfortable with functions that work on rows.

=== Investigate

Student work in groups or pairs.

[.lesson-instruction]
Complete @printable-exercise{pages/row-and-function-definitions.adoc}.

Take a look at the three examples for `is-dog`. Each one shows us a different way of thinking about examples, in this case using a row that should return `false`:

. The first example tells us that we should expect `is-dog` to return `false`. We defined this row to be a cat, so we want to see a `false` result!
. The second example shows us some of the work involved: we know the species of the row is `"cat"`, and comparing that to the String `"dog"` will return false.
. The third example shows __all the work__: given the `cat-row`, we lookup the value in the `"species"` column and compare it to the String `"dog"`.

[.lesson-instruction]
Add three _true_ examples for `is-dog`, this time using the `dog-row` you defined above.

=== Synthesize
Have students explain what each function does. Challenge them to use terminology like "looks up the value in the X column" when describing a lookup.


== Ordering, Filtering, and Building @duration{10 minutes}

=== Overview
Students learn to sort rows of a table in ascending or descending order, filter the rows using a Boolean-producing function, and build a new column.

=== Launch

Select 6-8 students, each of whom will represent a unique Row of a dataset called “Students.”  Arrange them in a line at the front of the room. Tell the class that you are going to select a volunteer who will play the role of… *Order*!

[.lesson-point]
A Table is a collection of Rows. And we can _do things_ to collections!

Announce to your volunteer "Sort the Rows by height, from smallest to largest!", and have them do it. Then announce to your volunteer "Sort the Rows by height, from largest to smallest!", and have them do it.

Give the volunteer a round of applause, and then tell the class that you are going to select another volunteer who will play the role of… *Filter*!

Hand the volunteer a Function card from the @opt-printable-exercise{pages/function-cards.adoc, Function Cards} set. Instruct them to read the card carefully, making sure they understand what it will do for each "Row" (student!) in the "Table" (line of students), but to keep that information a secret from the other students.

Explain to the class that the volunteer playing Filter will walk from one student to the next, referring to the function (on the card) in order to determine if each student should stand or sit.

Here’s how that might look if Filter chose an expression called `likes-pizza`.

* *Filter to Student 1:* Do you like pizza?
* *Student 1:* Yes
* *Filter:* Remain standing. (Student 1 remains standing.)
* *Filter to Student 2:* Do you like pizza?
* *Student 2:* No.
* *Filter:* Sit down. (Student 2 sits.)

Have your Filter volunteer go through all their peers, applying their card to each one.

[.lesson-instruction]
Based on who sat and who stayed, what was on the card?

Pyret Tables have their own methods for sorting, filtering, and more.

=== Investigate
[.lesson-instruction]
Complete questions 1-6 on @printable-exercise{exploring-methods.adoc}

Have the class explain how the `.order-by` method works. `.order-by` consumes a String (the name of the column by which to sort) and a Boolean (`true` for ascending, `false` for descending).

Does sorting the `animals-table` produce a _new_ table, or change the existing one? How could we test this?

[.lesson-instruction]
Complete questions 7-13 on @printable-exercise{exploring-methods.adoc}

Have the class explain how the `.filter` method works. `.filter` takes a _function_, and produces a new table containing only rows for which the function returns `true`.

[.lesson-instruction]
Complete questions 14-16 on @printable-exercise{exploring-methods.adoc}

Have the class explain how the `.build-column` method works. `.build-column` takes in a String and a _function_, and produces a new table with an extra column. It uses the String for the column title, and fills in the values by applying the function to every Row.

[.lesson-instruction]
How well do you understand these methods? Complete @opt-printable-exercise{pages/what-table-do-we-get.adoc}.

=== Common Misconceptions
*Students often think that these methods _change_ the table!* In Pyret, all table methods produce a _brand new table_. If we want to save that table, we need to define it. For example: `cats = animals-table.filter(is-cat)`.

=== Synthesize
Debrief with students. Being able to define functions and use them with Table Methods is a _huge_ upgrade in our ability to analyze data!

- Suppose we wanted to determine whether cats or dogs get adopted faster. How might using the `.filter` method help?
- If the shelter is purchasing food for older cats, what filter would we write to determine how many cats to buy for?
- The animals shelter might want to print nametags for every animal. They could build a column using the `label` function to have every animal's name in big, purple letters.
- A dataset from Europe might list everything in metric (centimeters, kilograms, etc), so we could build a column to convert that to imperial units (inches, pounds, etc).
- A dataset about schools might include columns for how many students are in the school and how many of those students identify as multi-racial. But when comparing schools of different sizes, what we really want is a column showing what _percentage_ of students identify as multi-racial. We could use `.build-column` to compute that for every row in the table.
